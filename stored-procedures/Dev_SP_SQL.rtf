{\rtf1\ansi\ansicpg1252\cocoartf1671\cocoasubrtf600
{\fonttbl\f0\fswiss\fcharset0 Helvetica;}
{\colortbl;\red255\green255\blue255;}
{\*\expandedcolortbl;;}
\margl1440\margr1440\vieww25380\viewh15220\viewkind0
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0

\f0\fs24 \cf0 Current \
\
\'97 SP_Create_Game.  Stored Procedure to create a Game entry in the Dev_Games Table.  Returns the Game_ID of the Game entry that was created.\
\
BEGIN\
	INSERT INTO Dev_Games(Game_Date) Values (CURRENT_TIMESTAMP());\
	SELECT LAST_INSERT_ID() INTO new_gameid;\
END\
\
\
\
\
NEW as of 3/7/2020 11:34am\
\
\'97 Centralized Stored Procedure to be a one stop place to create a new Game entry, generate a random list of Categories and then generate a random set of Jeopardy Questions from those categories.  Returns the Game_ID of the created \'97 Game.\
\
BEGIN\
    DECLARE done BOOLEAN DEFAULT 0; \
    DECLARE catarray VARCHAR(50); \
    DECLARE new_gameid INT;\
    DECLARE i INT DEFAULT 0;\
    DECLARE rnd VARCHAR(1);\
    DECLARE cat_list CURSOR FOR\
\
\'97 Generate the Random Categories\
    \
    	SELECT DISTINCT\
        		category\
    	FROM\
        		Questions\
    	ORDER BY RAND()\
    	LIMIT 13; \
    \
    DECLARE CONTINUE HANDLER FOR SQLSTATE '02000' SET done = 1; \
    CALL SP_Create_Game(@new_gameid);\
    \
    OPEN cat_list; \
    REPEAT \
    \
    	FETCH cat_list INTO catarray;\
\
\'97 Set up variable for what round to use\
    	IF ( ! done ) THEN\
		SET i=i+1;\
		IF i <=6 THEN\
	   	    SET rnd = "1";\
		ELSEIF  i<=12 THEN\
	               SET rnd = "2";\
		ELSEIF i=13 THEN\
	   	    SET rnd = "F";\
    		END IF;\
	\
		\'97 Write out the generated Categories to the Category Table\
	  	INSERT INTO Dev_Category(Category, Game_ID) VALUES(catarray,@new_gameid);\
 	 \
		\'97 Generate the random questions associated with each Category and Write out the Questions to the Questions Table\
		IF rnd <> "F" THEN\
     			INSERT INTO Dev_Game_Questions(Games_Game_ID, Questions_Question_ID, Question_Text, Answer_Text, Category, `Value`, Round)\
			SELECT @new_gameid, Question_ID, Question_Text, Question_Answer,Questions.Category, `Value`, rnd\
           		FROM Questions\
			WHERE Questions.Category = catarray\
           		ORDER BY RAND () LIMIT 5;\
     		ELSE      \
     			INSERT INTO Dev_Game_Questions(Games_Game_ID, Questions_Question_ID, Question_Text, Answer_Text, Category, Round)\
			SELECT @new_gameid, Question_ID, Question_Text, Question_Answer,Questions.Category,  rnd\
           		FROM Questions\
			WHERE Questions.Category = catarray\
           		ORDER BY RAND () LIMIT 1;\
	  	END IF;\
	END IF;\
    UNTIL done END REPEAT; \
\
    CLOSE cat_list;\
    SELECT @new_gameid;\
END}